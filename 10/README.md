# JACK 语言编译器前端实现

实现一种语言的编译器前端有多种方法，主要包括两个部分：

- 词法解析器
- 语法解析器

其中词法解析过程可以使用手动编程构建有限状态机的方式来实现，而语法解析器则需要手动实现上下文无关文法的分析。如果语言比较复杂的话，手动实现工作量巨大，也不易于修改和完善，这是手动实现的一些弊端，当然手动实现是一种非常棒的学习方法，这一点是不可否认的。

如果有能力手动实现那自然是很好的，在这其中也有一个陷阱，那就是不要做没有理论指导的手动实现。例如实现词法解析器的过程，你当然可以自己创造一种蹩脚的方式来实现词法解析，但是如果读过词法解析的相关理论，就自然知道有更好的实现方法，那么在初期学习的阶段就没有必要自己绞尽脑汁去做一种坐井观天的实现，而是要先学习现有的理论知识，后续知道更多了，再来改进现有的工作才是更好的做法。

说实话手动实现一个编译器前端对我来说确实是个比较困难的工作，但是我感觉这项技能似乎用到的地方很多，比如说：

- 理解不同语言之间的异同点
- 根据 BNF 理解某段代码是否符合语言规范
- 理解自动生成程序流程图的过程
- 更快地学会一门新的语言

理解编译原理好处多多，因此我不想放弃，决定花费更多时间在这项技能上，我决定先学习 ANTLR，后续利用该工具能解决一些工作上所需要处理的形式文本的问题，在实践中不断理解编译原理。话不多说，接下来就认真学习 ANTLR 工具吧。 

## ANTLR 安装配置方法

具体的安装方法可以在每次安装的时候到 ANTLR 的官方仓库去找，就没必要写的很仔细了，linux 机器上的安装时比较方便的，所以这里就只列出 windows 下安装以及配置方法了。

### Windows

安装 java 开发环境，修改 antlr_jar 文件夹下的 bat 文件，将 jar 文件的指定路径修改正确，
然后将 bat 文件所在目录加入系统环境变量，即可使用 antlr 与 grun 命令开发与验证语法分析应用。

## ANTLR 使用方法初探

### 利用 ANTLR 进行词法解析

- 编译词法规则

```
antlr Hello.g4
```
- 编译规则文件，生成词法分析器

```
javac *.java
```

- 调用生成的词法分析器，打印出对 hello.txt 的词法分析结果

```shell
grun Hello tokens -tokens hello.txt
```

### ANTLR 语法解析示例

在语法解析前需要先进行词法解析，将输入的文本提取为一个个 token，然后再进行语法分析，生成抽象语法树即 AST。所以语法解析一般都会引用先前编写的词法解析规则，然后在此基础上扩展语法规则。

一般情况下，如果词法解析文件比较复杂，那么会将词法解析规则单独放置在一个文件中，然后在语法解析规则文件中引用词法解析规则文件。当然如果词法解析非常简单，那么自然可以将词法解析与语法解析放置在一个文件中。

- 生成解析器与词法分析器

  ```
  antlr Hello.g4
  ```

- 编译规则文件，生成语法分析器

  ```
  javac *.java
  ```

- 利用 `grun` 验证规则文件

  ```shell
  grun Hello r -tokens
  ```

  ```
  grun Hello r -tree
  ```

  ```shell
  grun Hello r -tree -gui # 图形化的方式展示语法树
  ```

### Options briefly

| Options                | 作用                                                         |
| ---------------------- | ------------------------------------------------------------ |
| -tokens                | 打印出字元流（tokens）                                       |
| -tree                  | 使用 LISP 形式打印出解析树                                   |
| -gui                   | 使用对话框的形式可视化展示解析树                             |
| -ps file.ps            | generates a visual representation of the parse tree in PostScript and stores it in file.ps. The parse tree figures in this chapter were generated with -ps. |
| -encoding encodingname | specifies the test rig input file encoding if the current locale would not read the input properly. |
| -trace                 | 按照规则进入和退出的时候打印规则名称以及当前 token           |
| -diagnostics           | 在解析过程中打开诊断信息。这个选项产生的信息只是为了一些非一般的情况，例如模棱两可的输入短语 |
| -SLL                   | 使用一种更快速但是更弱的解析策略                             |

